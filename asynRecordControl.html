<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>asyn Record I/O Example &mdash; asyn support</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/my_theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="HowToDoSerial (StreamDevice)" href="HowToDoSerial.html" />
    <link rel="prev" title="asyn Timestamp Support" href="asynTimeStampSupport.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            asyn
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="asynDriver.html">asynDriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="asynPortDriver.html">asynPortDriver</a></li>
<li class="toctree-l1"><a class="reference internal" href="asynPortClient.html">asynPortClient</a></li>
<li class="toctree-l1"><a class="reference internal" href="asynRecord.html">asyn Record</a></li>
<li class="toctree-l1"><a class="reference internal" href="asynTimeStampSupport.html">asyn Timestamp Support</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">asyn Record I/O Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main-control-screen-asynrecord-adl">Main control screen, asynRecord.adl</a></li>
<li class="toctree-l2"><a class="reference internal" href="#asynoctet-i-o-screen-asynoctet-adl">asynOctet I/O screen, asynOctet.adl</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">asynOctet I/O screen, asynOctet.adl</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="HowToDoSerial.html">HowToDoSerial (StreamDevice)</a></li>
<li class="toctree-l1"><a class="reference internal" href="devGpib.html">devGpib (obsolete)</a></li>
<li class="toctree-l1"><a class="reference internal" href="doxygen.html">Doxygen documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">asyn</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">asyn Record I/O Example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/asynRecordControl.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="asyn-record-i-o-example">
<h1>asyn Record I/O Example<a class="headerlink" href="#asyn-record-i-o-example" title="Link to this heading"></a></h1>
<p>This document describes how to use an asyn record to communicate with a message-based instrument.</p>
<p>It is a step-by-step example of how I set up simple instrument control
using only an asyn record. The instrument may be connected to a
local serial port, a USB/Serial adapter, a LAN/Serial adapter, a
network port (raw TCP or VXI-11), a local GPIB interface or a LAN/GPIB adapter.</p>
<ul>
<li><p>Create a new application</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">serialTest</span>
<span class="n">cd</span> <span class="n">serialTest</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">epics</span><span class="o">/</span><span class="n">R3</span><span class="mf">.14.11</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">darwin</span><span class="o">-</span><span class="n">x86</span><span class="o">/</span><span class="n">makeBaseApp</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">l</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">epics</span><span class="o">/</span><span class="n">R3</span><span class="mf">.14.11</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">darwin</span><span class="o">-</span><span class="n">x86</span><span class="o">/</span><span class="n">makeBaseApp</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">t</span> <span class="n">ioc</span> <span class="n">serialTest</span><span class="o">&lt;</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">epics</span><span class="o">/</span><span class="n">R3</span><span class="mf">.14.11</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">darwin</span><span class="o">-</span><span class="n">x86</span><span class="o">/</span><span class="n">makeBaseApp</span><span class="o">.</span><span class="n">pl</span> <span class="o">-</span><span class="n">i</span> <span class="o">-</span><span class="n">t</span> <span class="n">ioc</span> <span class="n">serialTest</span>
</pre></div>
</div>
</li>
<li><p>Add ASYN support.
Edit configure/RELEASE and add a line specifying the path to your ASYN installation</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ASYN</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">epics</span><span class="o">/</span><span class="n">R3</span><span class="mf">.14.11</span><span class="o">&lt;/</span><span class="n">modules</span><span class="o">/</span><span class="n">soft</span><span class="o">/</span><span class="n">asyn</span>
</pre></div>
</div>
</li>
<li><p>Edit serialTestApp/src/Makefile and add two lines. It should be
apparent from the template where these lines are to be placed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">serialTest_DBD</span> <span class="o">+=</span> <span class="n">drvVxi11</span><span class="o">.</span><span class="n">dbd</span>
<span class="n">serialTest_LIBS</span> <span class="o">+=</span> <span class="n">asyn</span>
</pre></div>
</div>
<p>For a local serial port or a USB/Serial adapter, replace <cite>drvVxi11</cite> with <cite>drvAsynSerialPort</cite>.
For a ‘telnet’ style network port (instrument or LAN/Serial adapter), replace <cite>drvVxi11</cite> with <cite>drvAsynIPPort</cite>.</p>
</li>
<li><p>Edit serialTestApp/Db/Makefile and add a line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>DB_INSTALLS += $(ASYN)/db/asynRecord.db
</pre></div>
</div>
</li>
<li><p>Edit iocBoot/iocSerialTest/st.cmd and add lines to configure the
serial, GPIB or network port and to load an ASYN record.</p></li>
<li><p>Here’s a complete st.cmd file showing how things should look when you’re finished.
You will, of course, have to substitute the IP address of your GPIB/LAN
adapter and the address of your GPIB device. You’ll likely want
to choose a different value for the PV name prefix macro (P) as
well. The IMAX and OMAX values should be large enough to handle
the longest messages you expect.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!../../bin/darwin-x86/serialTest
&lt;envPaths
cd ${TOP}
## Register all support components
dbLoadDatabase(&quot;dbd/serialTest.dbd&quot;,0,0)
serialTest_registerRecordDeviceDriver(pdbbase)
## Configure devices
vxi11Configure(&quot;L0&quot;,&quot;164.54.8.129&quot;,0,0.0,&quot;gpib0&quot;,0,0)
## Load record instances
dbLoadRecords(&quot;db/asynRecord.db&quot;,&quot;P=norum:,R=asyn,PORT=L0,ADDR=24,IMAX=100,OMAX=100&quot;)
cd ${TOP}/iocBoot/${IOC}
iocInit()
</pre></div>
</div>
<p>If you are using a LAN/Serial adapter or network attached device which
uses a raw TCP (‘telnet’ style) connection you would replace the <cite>vxi11Configure</cite>
command with a line like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">drvAsynIPPortConfigure</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span><span class="s2">&quot;192.168.0.23:4001&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>If you are using a local serial port or USB/Serial adapter replace the <cite>vxi11Configure</cite>
command with something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">drvAsynSerialPortConfigure</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span><span class="s2">&quot;/dev/tty.PL2303-000013FA&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">asynSetOption</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;baud&quot;</span><span class="p">,</span> <span class="s2">&quot;9600&quot;</span><span class="p">)</span>
<span class="n">asynSetOption</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;bits&quot;</span><span class="p">,</span> <span class="s2">&quot;8&quot;</span><span class="p">)</span>
<span class="n">asynSetOption</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;parity&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">)</span>
<span class="n">asynSetOption</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">)</span>
<span class="n">asynSetOption</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;clocal&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>
<span class="n">asynSetOption</span><span class="p">(</span><span class="s2">&quot;L0&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;crtscts&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Build the application (run <cite>make</cite> from the application top directory).</p></li>
<li><p>Start the IOC</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">iocBoot</span><span class="o">/</span><span class="n">iocserialTest</span>
<span class="o">../../</span><span class="nb">bin</span><span class="o">/</span><span class="n">darwin</span><span class="o">-</span><span class="n">x86</span><span class="o">/</span><span class="n">serialTest</span> <span class="n">st</span><span class="o">.</span><span class="n">cmd</span>
</pre></div>
</div>
</li>
<li><p>From another window, start MEDM. Make sure that the P and R macro values match those from st.cmd.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">medm</span> <span class="o">-</span><span class="n">x</span>  <span class="o">-</span><span class="n">macro</span> <span class="s2">&quot;P=norum:,R=asyn&quot;</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">epics</span><span class="o">/</span><span class="n">R3</span><span class="mf">.14.11</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">soft</span><span class="o">/</span><span class="n">asyn</span><span class="o">/</span><span class="n">medm</span><span class="o">/</span><span class="n">asynRecord</span><span class="o">.</span><span class="n">adl</span>
</pre></div>
</div>
</li>
</ul>
<p>You should see something like the window shown below. I’ve made a
few changes to the original values including increasing the trace I/O
truncate size to 100 characters, enabling the traceIOEscape display and
turning on traceIODriver debugging.</p>
<section id="main-control-screen-asynrecord-adl">
<h2>Main control screen, asynRecord.adl<a class="headerlink" href="#main-control-screen-asynrecord-adl" title="Link to this heading"></a></h2>
<figure class="align-center" id="id2">
<img alt="_images/AsynRecordWindow.png" src="_images/AsynRecordWindow.png" />
<figcaption>
<p><span class="caption-text"><strong>asynRecord.adl</strong></span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Click on the ‘More…’ button and bring up the “asynOctet Interface
I/O” window. I’ve made some changes here as well. I’ve selected
Binary input format and increased the requested input length to
100. If your device messages are 40 characters or less you don’t
have to make this change. If you’re using a non-GPIB device you
probably need to specify appropriate input and output terminator
characters.</p>
</section>
<section id="asynoctet-i-o-screen-asynoctet-adl">
<h2>asynOctet I/O screen, asynOctet.adl<a class="headerlink" href="#asynoctet-i-o-screen-asynoctet-adl" title="Link to this heading"></a></h2>
<figure class="align-center" id="id3">
<img alt="_images/AsynOctetWindow.png" src="_images/AsynOctetWindow.png" />
<figcaption>
<p><span class="caption-text"><strong>asynOctet.adl</strong></span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Try entering some commands. A good one to start with is the SCPI
Device Identification (*IDN?) command. You can see why I had to
arrange for reply messages longer than the default 40 characters!</p>
</section>
<section id="id1">
<h2>asynOctet I/O screen, asynOctet.adl<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<figure class="align-center" id="id4">
<img alt="_images/AsynOctetIDN.png" src="_images/AsynOctetIDN.png" />
<figcaption>
<p><span class="caption-text"><strong>asynOctet.adl</strong></span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The readback display is truncated. Since I have traceIODriver
enabled I can see the entire message in the IOC console window:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>2007/09/20 09:01:15.998 L0 24 vxiWrite
*IDN?
2007/09/20 09:01:16.009 L0 24 vxiRead
KEITHLEY INSTRUMENTS INC.,MODEL 2400,1163289,C30   Mar 17 2006 09:29:29/A02  /K/J\n
</pre></div>
</div>
<p>If your requirements are modest, you might be done. The asyn
record may be adequate for your application. If not, you should
investigate the
<a class="reference external" href="HowToDoSerial.html">Streams device package</a>
for writing support for your instrument.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="asynTimeStampSupport.html" class="btn btn-neutral float-left" title="asyn Timestamp Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="HowToDoSerial.html" class="btn btn-neutral float-right" title="HowToDoSerial (StreamDevice)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Mark Rivers.
      <span class="lastupdated">Last updated on 2023-September-20.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>